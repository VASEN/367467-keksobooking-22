(()=>{"use strict";const e={flat:"Квартира",bungalow:"Бунгало",house:"Дом",palace:"Дворец"},t=document.querySelector("#card").content.querySelector(".popup"),r=e=>1===e?`${e} гостя`:`${e} гостей`,o=e=>1===e?`${e} комната`:e>=5?`${e} комнат`:`${e} комнаты`,n=e=>{e.style.display="none"},a=e=>{e.disabled=!0},i=e=>{e.disabled=!1},c=e=>"Esc"===e.key||"Escape"===e.key,l={SIZE:[40,40],ANCHOR:[20,40]},d={lat:35.685,lng:139.7514},s=document.querySelector("#address"),u=document.querySelector("#map-canvas"),p=window.L.map("map-canvas").setView(d,10),y=window.L.icon({iconUrl:"img/main-pin.svg",iconSize:l.SIZE,iconAnchor:l.ANCHOR}),m=window.L.icon({iconUrl:"img/pin.svg",iconSize:l.SIZE,iconAnchor:l.ANCHOR}),h=window.L.marker(d,{icon:y,draggable:!0});let v=window.L.layerGroup();h.on("move",(e=>{const t=e.target.getLatLng();s.value=`${t.lat.toFixed(5)}, ${t.lng.toFixed(5)}`}));const g=e=>{e.slice(0,10).forEach((e=>f(e))),v.addTo(p)},f=a=>{window.L.marker([a.location.lat,a.location.lng],{icon:m}).addTo(v).bindPopup((a=>{const i=t.cloneNode(!0),c=i.querySelector(".popup__avatar"),l=i.querySelector(".popup__title"),d=i.querySelector(".popup__text--address"),s=i.querySelector(".popup__text--price"),u=i.querySelector(".popup__type"),p=i.querySelector(".popup__text--capacity"),y=i.querySelector(".popup__text--time"),m=i.querySelector(".popup__features"),h=i.querySelector(".popup__description"),v=i.querySelector(".popup__photos"),{author:{avatar:g},offer:{address:f,checkin:S,checkout:_,descriptions:L,features:q,guests:E,photos:w,price:$,rooms:b,title:C,type:x}}=a;return C?l.textContent=C:n(l),f?d.textContent=f:n(d),$?s.innerHTML=`${$} <span>₽/ночь</span>`:n(s),x?u.textContent=e[x]:n(x),b||E?p.textContent=b?E?`${o(b)} для ${r(E)}`:`${o(b)}`:`Для ${r(E)}`:n(p),S||_?y.textContent=`Заезд после ${S} выезд до ${_}`:n(y),q?((e,t)=>{e.innerHTML="",t.forEach((t=>{const r=document.createElement("li");r.classList.add("popup__feature",`popup__feature--${t}`),e.appendChild(r)}))})(m,q):n(m),L?h.textContent=L:n(h),w?((e,t)=>{e.innerHTML="",t.forEach(((t,r)=>{const o=document.createElement("img");o.classList.add("popup__photo"),o.width=45,o.height=40,o.alt=`Фотография жилья ${r}`,o.src=`${t}`,e.appendChild(o)}))})(v,w):n(v),g?c.src=g:n(c),i})(a))},S="https://22.javascript.pages.academy/keksobooking",L=e=>{if(e.ok)return e;const{statusText:t,status:r}=e;throw new Error(`${r} - ${t}`)},q=document.querySelector("main"),E=document.querySelector("#error").content.querySelector(".error").cloneNode(!0),w=E.querySelector(".error__message"),$=e=>{c(e)&&(e.preventDefault(),b())},b=()=>{document.body.style.overflow="visible",E.removeEventListener("click",b),q.querySelector(".error__button").removeEventListener("click",b),document.removeEventListener("keydown",$),q.removeChild(q.querySelector(".error"))},C=e=>{w.textContent=e,document.body.style.overflow="hidden",E.addEventListener("click",b),E.querySelector(".error__button").addEventListener("click",b),document.addEventListener("keydown",$),q.appendChild(E)},x=document.querySelector("main"),k=document.querySelector("#success").content.querySelector(".success").cloneNode(!0),N=e=>{c(e)&&(e.preventDefault(),V())},V=()=>{document.body.style.overflow="visible",k.removeEventListener("click",V),document.removeEventListener("keydown",N),x.removeChild(x.querySelector(".success"))},A=document.querySelector(".map__filters"),T=()=>{A.classList.add("map__filters--disabled"),A.childNodes.forEach(a)},F=["gif","jpg","jpeg","png"],D=(e,t)=>{const r=e.files;if((e=>{const t=[];for(let r=0;r<e.length;r++)t.push(e[r].name.toLowerCase());return t})(r).every((e=>F.some((t=>e.endsWith(t)))))){let e=(e=>{const t=new Array(e.length);for(let e=0;e<t.length;e++){let r=new FileReader;t[e]=r}return t})(r);e.forEach((e=>{e.addEventListener("load",(()=>{if(t.src)t.src=e.result;else{let r=document.createElement("img");r.src=e.result,r.width=40,r.height=44,t.append(r)}}))})),((e,t)=>{for(let r=0;r<e.length;r++)t[r].readAsDataURL(e[r])})(r,e)}},H=document.querySelector(".ad-form"),M=H.querySelector("#title"),O=H.querySelector("#address"),R=H.querySelector("#type"),j=H.querySelector("#price"),U=H.querySelector("#timein"),z=H.querySelector("#timeout"),I=H.querySelector("#room_number"),Z=H.querySelector("#capacity"),P=H.querySelector(".ad-form__reset"),G=H.querySelector("#avatar"),W=H.querySelector(".ad-form-header__preview img"),B=H.querySelector("#images"),J=H.querySelector(".ad-form__photo"),K={flat:1e3,bungalow:0,house:5e3,palace:1e4},Q={1:["1"],2:["1","2"],3:["1","2","3"],100:["0"]},X=Array.from(Z.options),Y=()=>{H.reset(),A.reset(),p.setView(d,10),h.setLatLng(d),O.value=`${d.lat.toFixed(5)}, ${d.lng.toFixed(5)}`,ee(I.value)};M.addEventListener("input",(()=>{const e=M.value.length;M.validity.tooShort?M.setCustomValidity(`Длинна заголовка не менее 30 символов (${e}/30)`):M.validity.tooLong?M.setCustomValidity("Длинна заголовка не более 100 символов"):M.validity.valueMissing?M.setCustomValidity("Обязательное поле для заполнения!"):M.setCustomValidity(""),M.reportValidity()})),R.addEventListener("change",(()=>{j.min=K[R.value],j.placeholder=K[R.value]})),j.addEventListener("change",(()=>{j.validity.rangeUnderflow?j.setCustomValidity(`Стоимость должна быть выше ${j.placeholder}`):j.validity.rangeOverflow?j.setCustomValidity(`Стоимость должна быть ниже ${j.max}`):j.validity.valueMissing?j.setCustomValidity("Обязательное поле для заполнения!"):j.setCustomValidity(""),j.reportValidity()})),U.addEventListener("change",(()=>{z.value=U.value})),z.addEventListener("change",(()=>{U.value=z.value}));const ee=e=>{X.forEach((t=>{t.hidden=!Q[e].includes(t.value),t.selected=!t.hidden}))};I.addEventListener("change",(()=>{ee(I.value)})),P.addEventListener("click",(e=>{e.preventDefault(),Y()}));const te=()=>{Y(),document.body.style.overflow="hidden",k.addEventListener("click",V),document.addEventListener("keydown",N),x.appendChild(k)},re=()=>{C("Ошибка отправки формы!")};H.addEventListener("submit",(e=>{var t,r,o;e.preventDefault(),t=te,r=re,o=new FormData(e.target),fetch(`${S}`,{method:"POST",body:o}).then(L).then(t).catch(r)})),G.addEventListener("change",(()=>{D(G,W)})),B.addEventListener("change",(()=>{D(B,J)}));const oe="any",ne={low:{min:0,max:1e4},middle:{min:1e4,max:5e4},high:{min:5e4,max:1e6}},ae=document.querySelector(".map__filters"),ie=ae.querySelector("#housing-type"),ce=ae.querySelector("#housing-price"),le=ae.querySelector("#housing-rooms"),de=ae.querySelector("#housing-guests"),se=(e,t,r)=>r===oe||e.offer[t].toString()===(r||oe),ue=e=>{const t=se(e,"type",ie.value),r=se(e,"rooms",le.value),o=se(e,"guests",de.value),n=((e,t)=>t===oe||((e,t)=>e>=ne[t].min&&e<ne[t].max)(e.offer.price,t))(e,ce.value),a=(e=>{let t=Array.from(ae.querySelectorAll("input[type=checkbox]:checked"));return!t.length||t.every((t=>e.offer.features.includes(t.value)))})(e);return t&&r&&o&&n&&a};var pe,ye;p?((()=>{const e=p.getCenter();window.L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{attribution:'&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'}).addTo(p),h.addTo(p),u.childNodes.forEach((e=>e.hidden=!1)),H.classList.remove("ad-form--disabled"),H.childNodes.forEach(i),ee(I.value),A.classList.remove("map__filters--disabled"),A.childNodes.forEach(i),O.value=`${e.lat.toFixed(5)}, ${e.lng.toFixed(5)}`})(),pe=e=>{var t;g(e),t=_.debounce((()=>{v.clearLayers(),g((e=>e.filter(ue))(e))})),A.addEventListener("change",(()=>{t()}))},ye=()=>{T(),C("Не удалось загрузить данные с сервера!")},fetch(`${S}/data`).then(L).then((e=>e.json())).then(pe).catch(ye)):(u.childNodes.forEach((e=>e.hidden=!0)),H.classList.add("ad-form--disabled"),H.childNodes.forEach(a),T())})();
//# sourceMappingURL=main.bundle.js.map