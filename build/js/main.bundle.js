(()=>{"use strict";const e={flat:"Квартира",bungalow:"Бунгало",house:"Дом",palace:"Дворец"},t=document.querySelector("#card").content.querySelector(".popup"),r=e=>1===e?`${e} гостя`:`${e} гостей`,o=e=>1===e?`${e} комната`:e>=5?`${e} комнат`:`${e} комнаты`,n=e=>{e.style.display="none"},a=e=>{e.disabled=!0},i=e=>{e.disabled=!1},c=e=>"Esc"===e.key||"Escape"===e.key,l={SIZE:[40,40],ANCHOR:[20,40]},d={lat:35.685,lng:139.7514},s=document.querySelector("#address"),u=document.querySelector("#map-canvas"),p=window.L.map("map-canvas").setView(d,10),y=window.L.icon({iconUrl:"img/main-pin.svg",iconSize:l.SIZE,iconAnchor:l.ANCHOR}),m=window.L.icon({iconUrl:"img/pin.svg",iconSize:l.SIZE,iconAnchor:l.ANCHOR}),h=window.L.marker(d,{icon:y,draggable:!0});let v=window.L.layerGroup();h.on("move",(e=>{const t=e.target.getLatLng();s.value=`${t.lat.toFixed(5)}, ${t.lng.toFixed(5)}`}));const g=e=>{e.slice(0,10).forEach((e=>f(e))),v.addTo(p)},f=a=>{window.L.marker([a.location.lat,a.location.lng],{icon:m}).addTo(v).bindPopup((a=>{const i=t.cloneNode(!0),c=i.querySelector(".popup__avatar"),l=i.querySelector(".popup__title"),d=i.querySelector(".popup__text--address"),s=i.querySelector(".popup__text--price"),u=i.querySelector(".popup__type"),p=i.querySelector(".popup__text--capacity"),y=i.querySelector(".popup__text--time"),m=i.querySelector(".popup__features"),h=i.querySelector(".popup__description"),v=i.querySelector(".popup__photos"),{author:{avatar:g},offer:{address:f,checkin:S,checkout:_,descriptions:L,features:q,guests:E,photos:w,price:$,rooms:b,title:C,type:x}}=a;return C?l.textContent=C:n(l),f?d.textContent=f:n(d),$?s.innerHTML=`${$} <span>₽/ночь</span>`:n(s),x?u.textContent=e[x]:n(x),b||E?p.textContent=b?E?`${o(b)} для ${r(E)}`:`${o(b)}`:`Для ${r(E)}`:n(p),S||_?y.textContent=`Заезд после ${S} выезд до ${_}`:n(y),q?((e,t)=>{e.innerHTML="",t.forEach((t=>{const r=document.createElement("li");r.classList.add("popup__feature",`popup__feature--${t}`),e.appendChild(r)}))})(m,q):n(m),L?h.textContent=L:n(h),w?((e,t)=>{e.innerHTML="",t.forEach(((t,r)=>{const o=document.createElement("img");o.classList.add("popup__photo"),o.width=45,o.height=40,o.alt=`Фотография жилья ${r}`,o.src=`${t}`,e.appendChild(o)}))})(v,w):n(v),g?c.src=g:n(c),i})(a))},S="https://22.javascript.pages.academy/keksobooking",L=e=>{if(e.ok)return e;const{statusText:t,status:r}=e;throw new Error(`${r} - ${t}`)},q=(e,t)=>{fetch(`${S}/data`).then(L).then((e=>e.json())).then(e).catch(t)},E=document.querySelector("main"),w=document.querySelector("#error").content.querySelector(".error").cloneNode(!0),$=w.querySelector(".error__message"),b=e=>{c(e)&&(e.preventDefault(),C())},C=()=>{document.body.style.overflow="visible",w.removeEventListener("click",C),E.querySelector(".error__button").removeEventListener("click",C),document.removeEventListener("keydown",b),E.removeChild(E.querySelector(".error"))},x=e=>{$.textContent=e,document.body.style.overflow="hidden",w.addEventListener("click",C),w.querySelector(".error__button").addEventListener("click",C),document.addEventListener("keydown",b),E.appendChild(w)},k=document.querySelector("main"),N=document.querySelector("#success").content.querySelector(".success").cloneNode(!0),V=e=>{c(e)&&(e.preventDefault(),A())},A=()=>{document.body.style.overflow="visible",N.removeEventListener("click",A),document.removeEventListener("keydown",V),k.removeChild(k.querySelector(".success"))},T=document.querySelector(".map__filters"),F=()=>{T.classList.add("map__filters--disabled"),T.childNodes.forEach(a)},D=["gif","jpg","jpeg","png"],H=(e,t)=>{const r=e.files;if((e=>{const t=[];for(let r=0;r<e.length;r++)t.push(e[r].name.toLowerCase());return t})(r).every((e=>D.some((t=>e.endsWith(t)))))){let e=(e=>{const t=new Array(e.length);for(let e=0;e<t.length;e++){let r=new FileReader;t[e]=r}return t})(r);e.forEach((e=>{e.addEventListener("load",(()=>{if(t.src)t.src=e.result;else{let r=document.createElement("img");r.src=e.result,r.width=40,r.height=44,t.append(r)}}))})),((e,t)=>{for(let r=0;r<e.length;r++)t[r].readAsDataURL(e[r])})(r,e)}},M=document.querySelector(".ad-form"),O=M.querySelector("#title"),R=M.querySelector("#address"),j=M.querySelector("#type"),U=M.querySelector("#price"),z=M.querySelector("#timein"),I=M.querySelector("#timeout"),Z=M.querySelector("#room_number"),P=M.querySelector("#capacity"),G=M.querySelector(".ad-form__reset"),W=M.querySelector("#avatar"),B=M.querySelector(".ad-form-header__preview img"),J=M.querySelector("#images"),K=M.querySelector(".ad-form__photo"),Q={flat:1e3,bungalow:0,house:5e3,palace:1e4},X={1:["1"],2:["1","2"],3:["1","2","3"],100:["0"]},Y=Array.from(P.options),ee=()=>{M.reset(),T.reset(),p.setView(d,10),h.setLatLng(d),R.value=`${d.lat.toFixed(5)}, ${d.lng.toFixed(5)}`,te(Z.value)};O.addEventListener("input",(()=>{const e=O.value.length;O.validity.tooShort?O.setCustomValidity(`Длинна заголовка не менее 30 символов (${e}/30)`):O.validity.tooLong?O.setCustomValidity("Длинна заголовка не более 100 символов"):O.validity.valueMissing?O.setCustomValidity("Обязательное поле для заполнения!"):O.setCustomValidity(""),O.reportValidity()})),j.addEventListener("change",(()=>{U.min=Q[j.value],U.placeholder=Q[j.value]})),U.addEventListener("change",(()=>{U.validity.rangeUnderflow?U.setCustomValidity(`Стоимость должна быть выше ${U.placeholder}`):U.validity.rangeOverflow?U.setCustomValidity(`Стоимость должна быть ниже ${U.max}`):U.validity.valueMissing?U.setCustomValidity("Обязательное поле для заполнения!"):U.setCustomValidity(""),U.reportValidity()})),z.addEventListener("change",(()=>{I.value=z.value})),I.addEventListener("change",(()=>{z.value=I.value}));const te=e=>{Y.forEach((t=>{t.hidden=!X[e].includes(t.value),t.selected=!t.hidden}))};Z.addEventListener("change",(()=>{te(Z.value)})),G.addEventListener("click",(e=>{e.preventDefault(),ee(),q(ye,me)}));const re=()=>{ee(),document.body.style.overflow="hidden",N.addEventListener("click",A),document.addEventListener("keydown",V),k.appendChild(N),q(ye,me)},oe=()=>{x("Ошибка отправки формы!")};M.addEventListener("submit",(e=>{var t,r,o;e.preventDefault(),t=re,r=oe,o=new FormData(e.target),fetch(`${S}`,{method:"POST",body:o}).then(L).then(t).catch(r)})),W.addEventListener("change",(()=>{H(W,B)})),J.addEventListener("change",(()=>{H(J,K)}));const ne="any",ae={low:{min:0,max:1e4},middle:{min:1e4,max:5e4},high:{min:5e4,max:1e6}},ie=document.querySelector(".map__filters"),ce=ie.querySelector("#housing-type"),le=ie.querySelector("#housing-price"),de=ie.querySelector("#housing-rooms"),se=ie.querySelector("#housing-guests"),ue=(e,t,r)=>r===ne||e.offer[t].toString()===(r||ne),pe=e=>{const t=ue(e,"type",ce.value),r=ue(e,"rooms",de.value),o=ue(e,"guests",se.value),n=((e,t)=>t===ne||((e,t)=>e>=ae[t].min&&e<ae[t].max)(e.offer.price,t))(e,le.value),a=(e=>{let t=Array.from(ie.querySelectorAll("input[type=checkbox]:checked"));return!t.length||t.every((t=>e.offer.features.includes(t.value)))})(e);return t&&r&&o&&n&&a},ye=e=>{var t;g(e),t=_.debounce((()=>{v.clearLayers(),g((e=>e.filter(pe))(e))})),T.addEventListener("change",(()=>{t()}))},me=()=>{F(),x("Не удалось загрузить данные с сервера!")};p?((()=>{const e=p.getCenter();window.L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{attribution:'&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'}).addTo(p),h.addTo(p),u.childNodes.forEach((e=>e.hidden=!1)),M.classList.remove("ad-form--disabled"),M.childNodes.forEach(i),te(Z.value),T.classList.remove("map__filters--disabled"),T.childNodes.forEach(i),R.value=`${e.lat.toFixed(5)}, ${e.lng.toFixed(5)}`})(),q(ye,me)):(u.childNodes.forEach((e=>e.hidden=!0)),M.classList.add("ad-form--disabled"),M.childNodes.forEach(a),F())})();
//# sourceMappingURL=main.bundle.js.map