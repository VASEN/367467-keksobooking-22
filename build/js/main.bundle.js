(()=>{"use strict";const e={flat:"Квартира",bungalow:"Бунгало",house:"Дом",palace:"Дворец"},t=document.querySelector("#card").content.querySelector(".popup"),r=e=>1===e?`${e} гостя`:`${e} гостей`,o=e=>1===e?`${e} комната`:e>=5?`${e} комнат`:`${e} комнаты`,n=e=>{e.style.display="none"},a=["Esc","Escape"],i=e=>{e.disabled=!0},l=e=>{e.disabled=!1},c=e=>a.includes(e.key),d={SIZE:[40,40],ANCHOR:[20,40]},s={lat:35.685,lng:139.7514},u=document.querySelector("#address"),p=document.querySelector("#map-canvas"),y=window.L.map("map-canvas").setView(s,10),m=window.L.icon({iconUrl:"img/main-pin.svg",iconSize:d.SIZE,iconAnchor:d.ANCHOR}),h=window.L.icon({iconUrl:"img/pin.svg",iconSize:d.SIZE,iconAnchor:d.ANCHOR}),v=window.L.marker(s,{icon:m,draggable:!0});let g=window.L.layerGroup();v.on("move",(e=>{const t=e.target.getLatLng();u.value=`${t.lat.toFixed(5)}, ${t.lng.toFixed(5)}`}));const f=()=>{g.clearLayers()},S=e=>{e.slice(0,10).forEach((e=>L(e))),g.addTo(y)},L=a=>{window.L.marker([a.location.lat,a.location.lng],{icon:h}).addTo(g).bindPopup((a=>{const i=t.cloneNode(!0),l=i.querySelector(".popup__avatar"),c=i.querySelector(".popup__title"),d=i.querySelector(".popup__text--address"),s=i.querySelector(".popup__text--price"),u=i.querySelector(".popup__type"),p=i.querySelector(".popup__text--capacity"),y=i.querySelector(".popup__text--time"),m=i.querySelector(".popup__features"),h=i.querySelector(".popup__description"),v=i.querySelector(".popup__photos"),{author:{avatar:g},offer:{address:f,checkin:S,checkout:_,descriptions:L,features:q,guests:E,photos:w,price:C,rooms:$,title:b,type:x}}=a;return b?c.textContent=b:n(c),f?d.textContent=f:n(d),C?s.innerHTML=`${C} <span>₽/ночь</span>`:n(s),x?u.textContent=e[x]:n(x),$||E?p.textContent=$?E?`${o($)} для ${r(E)}`:`${o($)}`:`Для ${r(E)}`:n(p),S||_?y.textContent=`Заезд после ${S} выезд до ${_}`:n(y),q?((e,t)=>{e.innerHTML="",t.forEach((t=>{const r=document.createElement("li");r.classList.add("popup__feature",`popup__feature--${t}`),e.appendChild(r)}))})(m,q):n(m),L?h.textContent=L:n(h),w?((e,t)=>{e.innerHTML="",t.forEach(((t,r)=>{const o=document.createElement("img");o.classList.add("popup__photo"),o.width=45,o.height=40,o.alt=`Фотография жилья ${r}`,o.src=`${t}`,e.appendChild(o)}))})(v,w):n(v),g?l.src=g:n(l),i})(a))},q="https://22.javascript.pages.academy/keksobooking",E=e=>{if(e.ok)return e;const{statusText:t,status:r}=e;throw new Error(`${r} - ${t}`)},w=(e,t)=>{fetch(`${q}/data`).then(E).then((e=>e.json())).then(e).catch(t)},C=document.querySelector("main"),$=document.querySelector("#error").content.querySelector(".error").cloneNode(!0),b=$.querySelector(".error__message"),x=e=>{c(e)&&(e.preventDefault(),k())},k=()=>{document.body.style.overflow="visible",$.removeEventListener("click",k),C.querySelector(".error__button").removeEventListener("click",k),document.removeEventListener("keydown",x),C.removeChild(C.querySelector(".error"))},N=e=>{b.textContent=e,document.body.style.overflow="hidden",$.addEventListener("click",k),$.querySelector(".error__button").addEventListener("click",k),document.addEventListener("keydown",x),C.appendChild($)},V=document.querySelector("main"),A=document.querySelector("#success").content.querySelector(".success").cloneNode(!0),T=e=>{c(e)&&(e.preventDefault(),F())},F=()=>{document.body.style.overflow="visible",A.removeEventListener("click",F),document.removeEventListener("keydown",T),V.removeChild(V.querySelector(".success"))},D=document.querySelector(".map__filters"),H=()=>{D.classList.add("map__filters--disabled"),D.childNodes.forEach(i)},M=["gif","jpg","jpeg","png"],O=(e,t)=>{const r=e.files;if((e=>{const t=[];for(let r=0;r<e.length;r++)t.push(e[r].name.toLowerCase());return t})(r).every((e=>M.some((t=>e.endsWith(t)))))){let e=(e=>{const t=new Array(e.length);for(let e=0;e<t.length;e++){let r=new FileReader;t[e]=r}return t})(r);e.forEach((e=>{e.addEventListener("load",(()=>{if(t.src)t.src=e.result;else{let r=document.createElement("img");r.src=e.result,r.width=40,r.height=44,t.append(r)}}))})),((e,t)=>{for(let r=0;r<e.length;r++)t[r].readAsDataURL(e[r])})(r,e)}},R=e=>{if(e.src)e.src="img/muffin-grey.svg";else for(;e.firstChild;)e.removeChild(e.lastChild)},j=document.querySelector(".ad-form"),U=j.querySelector("#title"),z=j.querySelector("#address"),I=j.querySelector("#type"),Z=j.querySelector("#price"),P=j.querySelector("#timein"),G=j.querySelector("#timeout"),W=j.querySelector("#room_number"),B=j.querySelector("#capacity"),J=j.querySelector(".ad-form__reset"),K=j.querySelector("#avatar"),Q=j.querySelector(".ad-form-header__preview img"),X=j.querySelector("#images"),Y=j.querySelector(".ad-form__photo"),ee={flat:1e3,bungalow:0,house:5e3,palace:1e4},te={1:["1"],2:["1","2"],3:["1","2","3"],100:["0"]},re=Array.from(B.options),oe=()=>{j.reset(),D.reset(),y.setView(s,10),f(),w(he,ve),v.setLatLng(s),z.value=`${s.lat.toFixed(5)}, ${s.lng.toFixed(5)}`,ne(W.value),R(Q),R(Y)};U.addEventListener("input",(()=>{const e=U.value.length;U.validity.tooShort?U.setCustomValidity(`Длинна заголовка не менее 30 символов (${e}/30)`):U.validity.tooLong?U.setCustomValidity("Длинна заголовка не более 100 символов"):U.validity.valueMissing?U.setCustomValidity("Обязательное поле для заполнения!"):U.setCustomValidity(""),U.reportValidity()})),I.addEventListener("change",(()=>{Z.min=ee[I.value],Z.placeholder=ee[I.value]})),Z.addEventListener("change",(()=>{Z.validity.rangeUnderflow?Z.setCustomValidity(`Стоимость должна быть выше ${Z.placeholder}`):Z.validity.rangeOverflow?Z.setCustomValidity(`Стоимость должна быть ниже ${Z.max}`):Z.validity.valueMissing?Z.setCustomValidity("Обязательное поле для заполнения!"):Z.setCustomValidity(""),Z.reportValidity()})),P.addEventListener("change",(()=>{G.value=P.value})),G.addEventListener("change",(()=>{P.value=G.value}));const ne=e=>{re.forEach((t=>{t.hidden=!te[e].includes(t.value),t.selected=!t.hidden}))};W.addEventListener("change",(()=>{ne(W.value)})),J.addEventListener("click",(e=>{e.preventDefault(),oe()}));const ae=()=>{oe(),document.body.style.overflow="hidden",A.addEventListener("click",F),document.addEventListener("keydown",T),V.appendChild(A)},ie=()=>{N("Ошибка отправки формы!")};j.addEventListener("submit",(e=>{var t,r,o;e.preventDefault(),t=ae,r=ie,o=new FormData(e.target),fetch(`${q}`,{method:"POST",body:o}).then(E).then(t).catch(r)})),K.addEventListener("change",(()=>{O(K,Q)})),X.addEventListener("change",(()=>{O(X,Y)}));const le={low:{min:0,max:1e4},middle:{min:1e4,max:5e4},high:{min:5e4,max:1e6}},ce=document.querySelector(".map__filters"),de=ce.querySelector("#housing-type"),se=ce.querySelector("#housing-price"),ue=ce.querySelector("#housing-rooms"),pe=ce.querySelector("#housing-guests"),ye=(e,t,r)=>"any"===r||e.offer[t].toString()===r,me=e=>{const t=ye(e,"type",de.value),r=ye(e,"rooms",ue.value),o=ye(e,"guests",pe.value),n=((e,t)=>"any"===t||((e,t)=>e>=le[t].min&&e<le[t].max)(e.offer.price,t))(e,se.value),a=(e=>{let t=Array.from(ce.querySelectorAll("input[type=checkbox]:checked"));return!t.length||t.every((t=>e.offer.features.includes(t.value)))})(e);return t&&r&&o&&n&&a},he=e=>{var t;S(e),t=_.debounce((()=>{f(),S((e=>e.filter(me))(e))}),500),D.addEventListener("change",(()=>{t()}))},ve=()=>{H(),N("Не удалось загрузить данные с сервера!")};y.on("load")?((()=>{const e=y.getCenter();window.L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{attribution:'&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'}).addTo(y),v.addTo(y),p.childNodes.forEach((e=>e.hidden=!1)),j.classList.remove("ad-form--disabled"),j.childNodes.forEach(l),ne(W.value),D.classList.remove("map__filters--disabled"),D.childNodes.forEach(l),z.value=`${e.lat.toFixed(5)}, ${e.lng.toFixed(5)}`})(),w(he,ve)):(p.childNodes.forEach((e=>e.hidden=!0)),j.classList.add("ad-form--disabled"),j.childNodes.forEach(i),H())})();
//# sourceMappingURL=main.bundle.js.map