{"version":3,"sources":["webpack://keksobooking/./source/js/popup-card.js","webpack://keksobooking/./source/js/util.js","webpack://keksobooking/./source/js/map.js","webpack://keksobooking/./source/js/server-data.js","webpack://keksobooking/./source/js/error.js","webpack://keksobooking/./source/js/success.js","webpack://keksobooking/./source/js/map-form.js","webpack://keksobooking/./source/js/images.js","webpack://keksobooking/./source/js/ad-form.js","webpack://keksobooking/./source/js/page.js","webpack://keksobooking/./source/js/filter.js","webpack://keksobooking/./source/js/data.js"],"names":["typeTranslateEngToRus","flat","bungalow","house","palace","advertisementTemplate","document","querySelector","content","createGuestsString","col","createRoomsString","hideElement","element","style","display","escKeys","disableDOMElement","disabled","enableDOMElement","isEscEvent","evt","includes","key","ICON","SIZE","ANCHOR","CENTER_COORDS","lat","lng","advertisementFormAddress","mapCanvas","map","window","L","setView","mainIcon","icon","iconUrl","iconSize","iconAnchor","advertisementIcon","positionMarker","marker","draggable","markersLayer","layerGroup","on","currentLatLng","target","getLatLng","value","toFixed","clearMarkers","clearLayers","showMarkerList","advertisements","slice","forEach","advertisement","createMarker","addTo","item","location","bindPopup","newAdvertisement","cloneNode","nodeAvatar","nodeTitle","nodeAddress","nodePrice","nodeType","nodeCapacity","nodeTime","nodeFeatures","nodeDescriptions","nodePhotos","author","avatar","offer","address","checkin","checkout","descriptions","features","guests","photos","price","rooms","title","type","textContent","innerHTML","featureElement","createElement","classList","add","appendChild","addFeatures","index","photoElement","width","height","alt","src","addPhotos","createAdvertisement","URL","checkStatus","response","ok","statusText","status","Error","getData","onSuccess","onFail","fetch","then","json","catch","pageContent","newError","errorMessage","onErrorMessageEscKeydown","preventDefault","closeErrorMessage","body","overflow","removeEventListener","removeChild","showError","err","addEventListener","newSuccessMessage","onSuccessMessageEscKeydown","closeSuccessMessage","mapForm","disableMapForm","childNodes","FILE_TYPES","getImage","chooser","preview","files","filenames","i","length","push","name","toLowerCase","getFileNames","every","el","some","endsWith","readers","Array","reader","FileReader","createReaders","result","imgTag","append","readAsDataURL","readFiles","clearImages","firstChild","lastChild","advertisementForm","advertisementFormTitle","advertisementFormType","advertisementFormPrice","advertisementFormCheckin","advertisementFormCheckout","advertisementFormRooms","advertisementFormCapacity","advertisementFormReset","avatarChooser","avatarPreview","housingImagesChooser","housingImagesPreview","typeConvertToPrice","roomsToGuests","1","2","3","100","capacityOptions","from","options","reloadPage","reset","getDataSuccess","getDataFailure","setLatLng","addAdvertisementFormCapacityItems","titleLength","validity","tooShort","setCustomValidity","tooLong","valueMissing","reportValidity","min","placeholder","rangeUnderflow","rangeOverflow","max","number","hidden","selected","sendSuccess","sendFail","FormData","method","priceFilterValueToRange","low","middle","high","typeFilter","priceFilter","roomsFilter","guestsFilter","checkFilter","filter","filterValue","toString","checkFilters","isTypeCheck","isRoomsCheck","isGuestsCheck","isPriceCheck","isPriceInRange","checkPriceFilter","isFeaturesCheck","querySelectorAll","checkFeaturesFilter","cb","_","debounce","useFilter","center","getCenter","tileLayer","attribution","remove","activatePage"],"mappings":"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","file":"main.bundle.js","sourcesContent":["const typeTranslateEngToRus = {\n  flat: 'Квартира',\n  bungalow: 'Бунгало',\n  house: 'Дом',\n  palace: 'Дворец',\n};\n\nconst PHOTO_SIZE = {\n  width: 45,\n  height: 40,\n}\n\nconst guestColToForm = {\n  singular: 1,\n};\n\nconst roomColToForm = {\n  singular: 1,\n  plural: 5,\n};\n\nconst advertisementTemplate = document.querySelector('#card')\n  .content\n  .querySelector('.popup');\n\nconst createGuestsString = (col) => {\n  return col === guestColToForm.singular ? `${col} гостя` : `${col} гостей`;\n};\n\nconst createRoomsString = (col) => {\n  if (col === roomColToForm.singular) {\n    return `${col} комната`;\n  } else if (col >= roomColToForm.plural) {\n    return `${col} комнат`;\n  } else {\n    return `${col} комнаты`;\n  }\n};\n\nconst addFeatures = (nodeFeatures, features) => {\n  nodeFeatures.innerHTML = '';\n  features.forEach((item) => {\n    const featureElement = document.createElement('li');\n    featureElement.classList.add('popup__feature',`popup__feature--${item}`);\n    nodeFeatures.appendChild(featureElement);\n  });\n};\n\nconst addPhotos = (nodePhotos, photos) => {\n  nodePhotos.innerHTML = '';\n  photos.forEach((item, index) => {\n    const photoElement = document.createElement('img');\n    photoElement.classList.add('popup__photo');\n    photoElement.width = PHOTO_SIZE.width;\n    photoElement.height = PHOTO_SIZE.height;\n    photoElement.alt = `Фотография жилья ${index}`;\n    photoElement.src = `${item}`;\n    nodePhotos.appendChild(photoElement);\n  });\n};\n\nconst hideElement = (element) => {\n  element.style.display = 'none';\n};\n\nconst createAdvertisement = (advertisement) => {\n  const newAdvertisement = advertisementTemplate.cloneNode(true);\n  const nodeAvatar = newAdvertisement.querySelector('.popup__avatar');\n  const nodeTitle = newAdvertisement.querySelector('.popup__title');\n  const nodeAddress = newAdvertisement.querySelector('.popup__text--address');\n  const nodePrice = newAdvertisement.querySelector('.popup__text--price');\n  const nodeType = newAdvertisement.querySelector('.popup__type');\n  const nodeCapacity = newAdvertisement.querySelector('.popup__text--capacity');\n  const nodeTime = newAdvertisement.querySelector('.popup__text--time');\n  const nodeFeatures = newAdvertisement.querySelector('.popup__features');\n  const nodeDescriptions = newAdvertisement.querySelector('.popup__description');\n  const nodePhotos = newAdvertisement.querySelector('.popup__photos');\n\n  const {\n    author: {\n      avatar,\n    },\n    offer: {\n      address,\n      checkin,\n      checkout,\n      descriptions,\n      features,\n      guests,\n      photos,\n      price,\n      rooms,\n      title,\n      type,\n    },\n  } = advertisement;\n  title ? nodeTitle.textContent = title : hideElement(nodeTitle);\n  address ? nodeAddress.textContent = address : hideElement(nodeAddress);\n  price ? nodePrice.innerHTML = `${price} <span>₽/ночь</span>` : hideElement(nodePrice);\n  type ? nodeType.textContent = typeTranslateEngToRus[type] : hideElement(type);\n  if (!rooms && !guests) {\n    hideElement(nodeCapacity);\n  } else if (!rooms) {\n    nodeCapacity.textContent = `Для ${createGuestsString(guests)}`;\n  } else if (!guests) {\n    nodeCapacity.textContent = `${createRoomsString(rooms)}`;\n  } else {\n    nodeCapacity.textContent = `${createRoomsString(rooms)} для ${createGuestsString(guests)}`;\n  }\n  if (!checkin && !checkout) {\n    hideElement(nodeTime);\n  } else {\n    nodeTime.textContent = `Заезд после ${checkin} выезд до ${checkout}`;\n  }\n  features ? addFeatures(nodeFeatures, features) : hideElement(nodeFeatures);\n  descriptions ? nodeDescriptions.textContent = descriptions : hideElement(nodeDescriptions);\n  photos ? addPhotos(nodePhotos, photos) : hideElement(nodePhotos);\n  avatar ? nodeAvatar.src = avatar : hideElement(nodeAvatar);\n\n  return newAdvertisement;\n}\n\nexport {createAdvertisement};\n","const FLOAT_LENGTH = 5;\n\nconst escKeys = ['Esc', 'Escape'];\n\nconst disableDOMElement = (element) => {\n  element.disabled = true;\n}\n\nconst enableDOMElement = (element) => {\n  element.disabled = false;\n}\n\nconst isEscEvent = (evt) => {\n  return escKeys.includes(evt.key);\n}\n\nexport {isEscEvent, disableDOMElement, enableDOMElement, FLOAT_LENGTH};\n","import {createAdvertisement} from './popup-card.js';\nimport {FLOAT_LENGTH} from './util.js';\n\nconst ICON = {\n  SIZE: [40, 40],\n  ANCHOR: [20, 40],\n};\n\nconst CENTER_COORDS = {\n  lat: 35.685,\n  lng: 139.7514,\n};\n\nconst ADVERTISEMENT_MARKERS_COUNT = 10;\nconst MAP_ZOOM = 10;\nconst advertisementFormAddress = document.querySelector('#address');\nconst mapCanvas = document.querySelector('#map-canvas');\n\nconst map = window.L.map('map-canvas')\n  .setView(CENTER_COORDS, MAP_ZOOM);\n\nconst mainIcon = window.L.icon({\n  iconUrl: 'img/main-pin.svg',\n  iconSize: ICON.SIZE,\n  iconAnchor: ICON.ANCHOR,\n});\n\nconst advertisementIcon = window.L.icon({\n  iconUrl: 'img/pin.svg',\n  iconSize: ICON.SIZE,\n  iconAnchor: ICON.ANCHOR,\n});\n\nconst positionMarker = window.L.marker(\n  CENTER_COORDS,\n  {\n    icon: mainIcon,\n    draggable: true,\n  },\n);\n\nlet markersLayer = window.L.layerGroup();\n\npositionMarker.on('move', (evt) => {\n  const currentLatLng = evt.target.getLatLng();\n  advertisementFormAddress.value = `${currentLatLng.lat.toFixed(FLOAT_LENGTH)}, ${currentLatLng.lng.toFixed(FLOAT_LENGTH)}`;\n});\n\nconst clearMarkers = () => {\n  markersLayer.clearLayers();\n};\n\nconst showMarkerList = (advertisements) => {\n  advertisements\n    .slice(0, ADVERTISEMENT_MARKERS_COUNT)\n    .forEach((advertisement) => createMarker(advertisement));\n  markersLayer.addTo(map);\n};\n\nconst createMarker = (item) => {\n  const advertisementMarker = window.L.marker(\n    [item.location.lat, item.location.lng],\n    {\n      icon: advertisementIcon,\n    },\n  );\n  advertisementMarker\n    .addTo(markersLayer)\n    .bindPopup(createAdvertisement(item));\n};\n\nexport {map, showMarkerList, clearMarkers, mapCanvas, positionMarker, CENTER_COORDS, MAP_ZOOM};\n","const URL = 'https://22.javascript.pages.academy/keksobooking';\nconst Method = {\n  GET: 'GET',\n  POST: 'POST',\n}\n\nconst checkStatus = (response) => {\n  if (response.ok) {\n    return response;\n  }\n  const {statusText, status} = response;\n  throw new Error(`${status} - ${statusText}`);\n}\n\nconst getData = (onSuccess, onFail) => {\n  fetch(`${URL}/data`)\n    .then(checkStatus)\n    .then((response) => response.json())\n    .then(onSuccess)\n    .catch(onFail);\n};\n\nconst sendData = (onSuccess, onFail, body) => {\n  fetch(`${URL}`, {method: Method.POST, body})\n    .then(checkStatus)\n    .then(onSuccess)\n    .catch(onFail);\n};\n\nexport {getData, sendData};\n","import {isEscEvent} from './util.js';\n\nconst pageContent = document.querySelector('main');\nconst errorTemplate = document.querySelector('#error').content.querySelector('.error');\nconst newError = errorTemplate.cloneNode(true);\nconst errorMessage = newError.querySelector('.error__message');\n\nconst onErrorMessageEscKeydown = (evt) => {\n  if (isEscEvent(evt)) {\n    evt.preventDefault();\n    closeErrorMessage();\n  }\n};\n\nconst closeErrorMessage = () => {\n  document.body.style.overflow = 'visible';\n  newError.removeEventListener('click', closeErrorMessage);\n  pageContent.querySelector('.error__button').removeEventListener('click', closeErrorMessage);\n  document.removeEventListener('keydown', onErrorMessageEscKeydown);\n  pageContent.removeChild(pageContent.querySelector('.error'));\n};\n\nconst showError = (err) => {\n  errorMessage.textContent = err;\n  document.body.style.overflow = 'hidden';\n  newError.addEventListener('click', closeErrorMessage);\n  newError.querySelector('.error__button').addEventListener('click', closeErrorMessage);\n  document.addEventListener('keydown', onErrorMessageEscKeydown);\n\n  pageContent.appendChild(newError);\n};\n\nexport {showError};\n","import {isEscEvent} from './util.js';\n\nconst pageContent = document.querySelector('main');\nconst successTemplate = document.querySelector('#success').content.querySelector('.success');\nconst newSuccessMessage = successTemplate.cloneNode(true);\n\n\nconst onSuccessMessageEscKeydown = (evt) => {\n  if (isEscEvent(evt)) {\n    evt.preventDefault();\n    closeSuccessMessage();\n  }\n};\n\nconst closeSuccessMessage = () => {\n  document.body.style.overflow = 'visible';\n  newSuccessMessage.removeEventListener('click', closeSuccessMessage);\n  document.removeEventListener('keydown', onSuccessMessageEscKeydown);\n  pageContent.removeChild(pageContent.querySelector('.success'));\n};\n\nconst showSuccess = () => {\n  document.body.style.overflow = 'hidden';\n  newSuccessMessage.addEventListener('click', closeSuccessMessage);\n  document.addEventListener('keydown', onSuccessMessageEscKeydown);\n\n  pageContent.appendChild(newSuccessMessage);\n};\n\nexport {showSuccess};\n","import {disableDOMElement, enableDOMElement} from './util.js';\n\nconst mapForm = document.querySelector('.map__filters');\n\nconst disableMapForm = () => {\n  mapForm.classList.add('map__filters--disabled');\n  mapForm.childNodes.forEach(disableDOMElement);\n};\n\nconst enableMapForm = () => {\n  mapForm.classList.remove('map__filters--disabled');\n  mapForm.childNodes.forEach(enableDOMElement);\n};\n\nconst setFilterForm = (cb) => {\n  mapForm.addEventListener('change', () => {\n    cb();\n  });\n}\n\nexport {disableMapForm, enableMapForm, setFilterForm, mapForm};\n","const FILE_TYPES = ['gif', 'jpg', 'jpeg', 'png'];\n\nconst IMAGE_SIZE = {\n  width: 40,\n  height: 44,\n}\n\nconst getFileNames = (files) => {\n  const filenames = [];\n  for (let i = 0; i < files.length; i++) {\n    filenames.push(files[i].name.toLowerCase());\n  }\n  return filenames;\n};\n\nconst createReaders = (files) => {\n  const readers = new Array(files.length);\n  for (let i = 0; i < readers.length; i++) {\n    let reader = new FileReader();\n    readers[i] = reader;\n  }\n  return readers;\n};\n\nconst readFiles = (files, readers) => {\n  for (let i = 0; i < files.length; i++) {\n    readers[i].readAsDataURL(files[i]);\n  }\n};\n\nconst getImage = (chooser, preview) => {\n  const files = chooser.files;\n\n  let filenames = getFileNames(files);\n\n  let matches = filenames.every((el) => {\n    return FILE_TYPES.some((item) => {\n      return el.endsWith(item);\n    })\n  });\n  if (matches) {\n    let readers = createReaders(files);\n\n    readers.forEach((item) => {\n      item.addEventListener('load', () => {\n        if (!preview.src) {\n          let imgTag = document.createElement('img');\n          imgTag.src = item.result;\n          imgTag.width = IMAGE_SIZE.width;\n          imgTag.height = IMAGE_SIZE.height;\n          preview.append(imgTag);\n        } else {\n          preview.src = item.result;\n        }\n      })\n    })\n    readFiles(files, readers);\n  }\n};\n\nconst clearImages = (preview) => {\n  if (preview.src) {\n    preview.src = 'img/muffin-grey.svg';\n  } else {\n    while (preview.firstChild) {\n      preview.removeChild(preview.lastChild);\n    }\n  }\n}\n\nexport {getImage, clearImages};\n","import {getData, sendData} from './server-data.js';\nimport {disableDOMElement, enableDOMElement, FLOAT_LENGTH} from './util.js';\nimport {showError} from './error.js';\nimport {showSuccess} from './success.js';\nimport {CENTER_COORDS, clearMarkers, map, MAP_ZOOM, positionMarker} from './map.js';\nimport {mapForm} from './map-form.js';\nimport {clearImages, getImage} from './images.js';\nimport {getDataSuccess, getDataFailure} from './data.js';\n\nconst advertisementForm = document.querySelector('.ad-form');\nconst advertisementFormTitle = advertisementForm.querySelector('#title');\nconst advertisementFormAddress = advertisementForm.querySelector('#address');\nconst advertisementFormType = advertisementForm.querySelector('#type');\nconst advertisementFormPrice = advertisementForm.querySelector('#price');\nconst advertisementFormCheckin = advertisementForm.querySelector('#timein');\nconst advertisementFormCheckout = advertisementForm.querySelector('#timeout');\nconst advertisementFormRooms = advertisementForm.querySelector('#room_number');\nconst advertisementFormCapacity = advertisementForm.querySelector('#capacity');\nconst advertisementFormReset = advertisementForm.querySelector('.ad-form__reset');\n\nconst avatarChooser = advertisementForm.querySelector('#avatar');\nconst avatarPreview = advertisementForm.querySelector('.ad-form-header__preview img');\n\nconst housingImagesChooser = advertisementForm.querySelector('#images');\nconst housingImagesPreview = advertisementForm.querySelector('.ad-form__photo');\n\nconst typeConvertToPrice = {\n  flat: 1000,\n  bungalow: 0,\n  house: 5000,\n  palace: 10000,\n};\n\nconst roomsToGuests = {\n  1: ['1'],\n  2: ['1', '2'],\n  3: ['1', '2', '3'],\n  100: ['0'],\n};\n\nconst capacityOptions = Array.from(advertisementFormCapacity.options);\n\nconst disableAdvertisementForm = () => {\n  advertisementForm.classList.add('ad-form--disabled');\n  advertisementForm.childNodes.forEach(disableDOMElement);\n};\n\nconst enableAdvertisementForm = () => {\n  advertisementForm.classList.remove('ad-form--disabled');\n  advertisementForm.childNodes.forEach(enableDOMElement);\n  addAdvertisementFormCapacityItems(advertisementFormRooms.value);\n};\n\nconst reloadPage = () => {\n  advertisementForm.reset();\n  mapForm.reset();\n  map.setView(CENTER_COORDS, MAP_ZOOM);\n  clearMarkers();\n  getData(getDataSuccess, getDataFailure);\n  positionMarker.setLatLng(CENTER_COORDS);\n  advertisementFormAddress.value = `${CENTER_COORDS.lat.toFixed(FLOAT_LENGTH)}, ${CENTER_COORDS.lng.toFixed(FLOAT_LENGTH)}`;\n  addAdvertisementFormCapacityItems(advertisementFormRooms.value);\n  clearImages(avatarPreview);\n  clearImages(housingImagesPreview);\n};\n\nadvertisementFormTitle.addEventListener('input', () => {\n  const titleLength = advertisementFormTitle.value.length;\n  if (advertisementFormTitle.validity.tooShort) {\n    advertisementFormTitle.setCustomValidity(`Длинна заголовка не менее 30 символов (${titleLength}/30)`);\n  } else if (advertisementFormTitle.validity.tooLong) {\n    advertisementFormTitle.setCustomValidity('Длинна заголовка не более 100 символов');\n  } else if (advertisementFormTitle.validity.valueMissing) {\n    advertisementFormTitle.setCustomValidity('Обязательное поле для заполнения!');\n  } else {\n    advertisementFormTitle.setCustomValidity('');\n  }\n  advertisementFormTitle.reportValidity();\n});\n\nadvertisementFormType.addEventListener('change', () => {\n  advertisementFormPrice.min = typeConvertToPrice[advertisementFormType.value];\n  advertisementFormPrice.placeholder = typeConvertToPrice[advertisementFormType.value];\n});\n\nadvertisementFormPrice.addEventListener('change', () => {\n  if (advertisementFormPrice.validity.rangeUnderflow) {\n    advertisementFormPrice.setCustomValidity(`Стоимость должна быть выше ${advertisementFormPrice.placeholder}`);\n  } else if (advertisementFormPrice.validity.rangeOverflow) {\n    advertisementFormPrice.setCustomValidity(`Стоимость должна быть ниже ${advertisementFormPrice.max}`);\n  } else if (advertisementFormPrice.validity.valueMissing) {\n    advertisementFormPrice.setCustomValidity('Обязательное поле для заполнения!');\n  } else {\n    advertisementFormPrice.setCustomValidity('');\n  }\n  advertisementFormPrice.reportValidity();\n});\n\nadvertisementFormCheckin.addEventListener('change', () => {\n  advertisementFormCheckout.value = advertisementFormCheckin.value;\n});\n\nadvertisementFormCheckout.addEventListener('change', () => {\n  advertisementFormCheckin.value = advertisementFormCheckout.value;\n});\n\nconst addAdvertisementFormCapacityItems = (number) => {\n  capacityOptions.forEach((item) => {\n    item.hidden = !roomsToGuests[number].includes(item.value);\n    item.selected = !item.hidden;\n  })\n};\n\nadvertisementFormRooms.addEventListener('change', () => {\n  addAdvertisementFormCapacityItems(advertisementFormRooms.value);\n});\n\nadvertisementFormReset.addEventListener('click', (evt) => {\n  evt.preventDefault();\n  reloadPage();\n});\n\nconst sendSuccess = () => {\n  reloadPage();\n  showSuccess();\n};\n\nconst sendFail = () => {\n  showError('Ошибка отправки формы!');\n};\n\nadvertisementForm.addEventListener('submit', (evt) => {\n  evt.preventDefault();\n  sendData(\n    sendSuccess,\n    sendFail,\n    new FormData(evt.target),\n  )\n});\n\navatarChooser.addEventListener('change', () => {\n  getImage(avatarChooser, avatarPreview);\n});\n\nhousingImagesChooser.addEventListener('change', () => {\n  getImage(housingImagesChooser, housingImagesPreview);\n})\n\nexport {advertisementForm, advertisementFormAddress, disableAdvertisementForm, enableAdvertisementForm};\n","import {map, mapCanvas, positionMarker} from './map.js';\nimport {advertisementFormAddress, disableAdvertisementForm, enableAdvertisementForm} from './ad-form.js';\nimport {disableMapForm, enableMapForm} from './map-form.js';\nimport {FLOAT_LENGTH} from './util.js';\n\nconst activatePage = () => {\n  const center = map.getCenter();\n  window.L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png',\n    {\n      attribution: '&copy; <a href=\"https://www.openstreetmap.org/copyright\">OpenStreetMap</a> contributors',\n    },\n  ).addTo(map);\n  positionMarker.addTo(map);\n  mapCanvas.childNodes.forEach(item => item.hidden = false);\n  enableAdvertisementForm();\n  enableMapForm();\n  advertisementFormAddress.value = `${center.lat.toFixed(FLOAT_LENGTH)}, ${center.lng.toFixed(FLOAT_LENGTH)}`;\n}\n\nconst deactivatePage = () => {\n  mapCanvas.childNodes.forEach(item => item.hidden = true);\n  disableAdvertisementForm();\n  disableMapForm();\n}\n\nexport {activatePage, deactivatePage};\n","const DEFAULT_TYPE = 'any';\n\nconst priceFilterValueToRange = {\n  low: {min: 0, max: 10000},\n  middle: {min: 10000, max: 50000},\n  high: {min: 50000, max: 1000000},\n}\n\nconst mapForm = document.querySelector('.map__filters');\nconst typeFilter = mapForm.querySelector('#housing-type');\nconst priceFilter = mapForm.querySelector('#housing-price');\nconst roomsFilter = mapForm.querySelector('#housing-rooms');\nconst guestsFilter = mapForm.querySelector('#housing-guests');\n\nconst isPriceInRange = (price, filterValue) => {\n  return (price >= priceFilterValueToRange[filterValue].min && price < priceFilterValueToRange[filterValue].max)\n}\n\nconst checkFilter = (item, filter, filterValue) => {\n  return filterValue === DEFAULT_TYPE || item.offer[filter].toString() === filterValue;\n}\n\nconst checkPriceFilter = (item, filterValue) => {\n  return filterValue === DEFAULT_TYPE || isPriceInRange(item.offer.price, filterValue);\n}\n\nconst checkFeaturesFilter = (item) => {\n  let features = Array.from(mapForm.querySelectorAll('input[type=checkbox]:checked'));\n  return !features.length || features.every((el) => item.offer.features.includes(el.value));\n}\n\nconst checkFilters = (item) => {\n  const isTypeCheck = checkFilter(item,  'type', typeFilter.value);\n  const isRoomsCheck = checkFilter(item, 'rooms', roomsFilter.value);\n  const isGuestsCheck = checkFilter(item, 'guests', guestsFilter.value);\n  const isPriceCheck = checkPriceFilter(item, priceFilter.value);\n  const isFeaturesCheck = checkFeaturesFilter(item);\n  return isTypeCheck && isRoomsCheck && isGuestsCheck && isPriceCheck && isFeaturesCheck;\n};\n\nconst useFilter = (advertisements) => {\n  return advertisements.filter(checkFilters);\n}\n\nexport {useFilter};\n","/* global _:readonly */\nimport {clearMarkers, map, showMarkerList} from './map.js';\nimport {getData} from './server-data.js';\nimport {activatePage, deactivatePage} from './page.js';\nimport {disableMapForm} from './map-form.js';\nimport {showError} from './error.js';\nimport {setFilterForm} from './map-form.js';\nimport {useFilter} from './filter.js';\n\nconst CREATE_MARKERS_DELAY = 500;\n\nconst getDataSuccess = (advertisements) => {\n  showMarkerList(advertisements);\n  setFilterForm(_.debounce(() => {\n    clearMarkers();\n    showMarkerList(useFilter(advertisements));\n  }, CREATE_MARKERS_DELAY));\n};\n\nconst getDataFailure = () => {\n  disableMapForm();\n  showError('Не удалось загрузить данные с сервера!');\n}\n\nif (map.on('load')) {\n  activatePage();\n  getData(getDataSuccess, getDataFailure);\n} else {\n  deactivatePage();\n}\n\nexport {getDataSuccess, getDataFailure}\n"],"sourceRoot":""}